set(CMAKE_INCLUDE_CURRENT_DIR on)
set(CMAKE_BUILD_TYPE Debug)

include_directories(${FRAMEPROCESSOR_DIR}/include ${ODINDATA_INCLUDE_DIRS} ${HDF5_INCLUDE_DIRS} ${Boost_INCLUDE_DIRS} ${LOG4CXX_INCLUDE_DIRS}/.. ${ZEROMQ_INCLUDE_DIRS})

# Add library for LATRD processing plugin
add_library(LATRDProcessPlugin SHARED LATRDProcessPlugin.cpp LATRDProcessPluginLib.cpp LATRDBuffer.cpp LATRDProcessJob.cpp)
target_link_libraries(LATRDProcessPlugin ${ODINDATA_LIBRARIES} ${Boost_LIBRARIES} ${LOG4CXX_LIBRARIES} ${ZEROMQ_LIBRARIES})

string(TIMESTAMP EXEC_TIME)
set(LATRD_EXEC_SCRIPT ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/execute_latrd_processor)
file(WRITE ${LATRD_EXEC_SCRIPT} "#!/bin/bash\n")
file(APPEND ${LATRD_EXEC_SCRIPT} "\n")
file(APPEND ${LATRD_EXEC_SCRIPT} "# This file is autogenerated - DO NOT EDIT\n")
file(APPEND ${LATRD_EXEC_SCRIPT} "# Generated on ${EXEC_TIME}\n")
file(APPEND ${LATRD_EXEC_SCRIPT} "\n")
file(APPEND ${LATRD_EXEC_SCRIPT} "# Executes the LATRD ODIN-DATA FrameProcessor\n")
file(APPEND ${LATRD_EXEC_SCRIPT} "\n")
file(APPEND ${LATRD_EXEC_SCRIPT} "cwd=$(pwd)\n")
file(APPEND ${LATRD_EXEC_SCRIPT} "cd ${ODINDATA_ROOT_DIR}\n")
file(APPEND ${LATRD_EXEC_SCRIPT} "./bin/frameProcessor --path ${CMAKE_BINARY_DIR}/lib -d LATRD \"$@\"\n")
file(APPEND ${LATRD_EXEC_SCRIPT} "cd $cwd\n")

install(
	FILES ${LATRD_EXEC_SCRIPT}
	PERMISSIONS OWNER_EXECUTE OWNER_READ
	DESTINATION bin
	)

install(TARGETS LATRDProcessPlugin LIBRARY DESTINATION lib)
